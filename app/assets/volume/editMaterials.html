<ng-form name="volumeEditMaterialsForm" flow-init="flowOptions"
    flow-file-added="volumeEditMaterialsForm.fileAdded($file, $event)"
    flow-file-success="volumeEditMaterialsForm.fileSuccess($file)"
    flow-file-progress="volumeEditMaterialsForm.fileProgress($file)">

  <scroll-float>
    <fieldset class="clean">
      <div class="col-desktop-5 col-tablet-4 col-mobile-6">
        <button class="green" ng-click="volumeEditMaterialsForm.saveAll()" message="save" ng-disabled="volumeEditMaterialsForm.$pristine"></button>
        <button ng-click="volumeEditMaterialsForm.resetAll()" message="revert" ng-disabled="volumeEditMaterialsForm.$pristine"></button>
      </div>  
      <section flow-drag-enter="dropClasses['over-form'] = true" flow-drag-leave="dropClasses['over-form'] = false" ng-init="dropClasses={'drop-zone': true}">
        <div class="vem-float-dropzone" flow-drop flow-btn flow-drag-enter="dropClasses['over-zone'] = true" flow-drag-leave="dropClasses['over-zone'] = false" ng-class="dropClasses">
          <span class="icon line add"></span>
          <span class="vem-float-dropzone-message" message="asset.add-drop"></span>
        </div>
      </section>
    </fieldset>
  </scroll-float>

  <fieldset ng-repeat="material in volumeEditMaterialsForm.materials"
      ng-form="material.form"
      flow-drag-enter="dropClasses['over-form'] = true"
      flow-drag-leave="dropClasses['over-form'] = false"
      ng-init="dropClasses={'drop-zone': true}"
      style="position: relative;" class="vem-repeat">

    <div class="vem-repeat-content">

      <validator name="file" label="asset.file">
        <div ng-if="!!material.file">
          <span ng-bind="material.file.name"></span>
          <upload-progress progress-value="material.progress"></upload-progress>
        </div>

        <div ng-if="material.replace" class="vem-file-dropzone" ng-class="dropClasses" flow-drag-enter="dropClasses['over-zone'] = true" flow-drag-leave="dropClasses['over-zone'] = false" flow-drop flow-btn id="material-drop-{{$index}}">
          <!--DO NOT USE ng-bind: problem with flow-btn/assignBrowse's child input-->
          {{::'asset.add-drop.replace' | message}}
        </div>

        <input ng-if="!!material.asset && !material.replace" type="text" name="filename" ng-value="material.asset.creation.name + ' ' + page.$filter('date')(material.asset.creation.date, 'medium')" disabled outside="volumeEditMaterialsForm">
        <div class="file-button-set">
          <button ng-if="!!material.asset && !material.replace" ng-click="volumeEditMaterialsForm.replace(material)" message="replace" class=" mini"></button>        
          <button class="mini" ng-disabled="material.pending" ng-click="volumeEditMaterialsForm.remove(material)" class="col-desktop-1 col-tablet-1 col-mobile-1"><span class="icon trash"></span></button>
        </div>

      </validator>

      <validator name="classification" label="asset.classification">
        <classification-select name="classification" ng-model="material.data.classification"></classification-select>
      </validator>

      <label class="option">
        <input type="checkbox" name="excerptOn" ng-model="material.data.excerptOn">
        <span message="asset.excerpt.checkbox-label"></span>
      </label>
      <validator noclientval class="excerpt-validator" name="excerpt" ng-show="material.data.excerptOn && material.data.classification < page.classification.PUBLIC" label="asset.excerpt">
        <select name="excerpt" ng-model="material.data.excerpt" ng-options="i as 'classification.excerpt.'+c | message for (i, c) in material.excerptOptions()"></select>
      </validator>

      <validator name="name" label="asset.name">
        <input type="text" name="name" ng-model="material.data.name" placeholder="{{::'asset.name.placeholder' | message}}">
      </validator>
    </div>
  </fieldset>
</ng-form>
